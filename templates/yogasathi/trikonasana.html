{% extends 'yogasathi/base.html' %} 
{% load static %}

{% block title %}Yoga Sathi - Trikonasana Coach{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"/>
    
    <style>
        /* FIX 1: Nav Bar ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§ó‡§π ‡§¨‡§®‡§æ‡§®‡•á ‡§π‡•á‡§§‡•Å <main> ‡§Æ‡•á‡§Ç ‡§ü‡•â‡§™ ‡§™‡•à‡§°‡§ø‡§Ç‡§ó ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (75px) */
        main {
            padding-top: 75px; 
            height: 100vh;
        }
        
        /* FIX 2: main-container ‡§ï‡•ã ‡§â‡§™‡§≤‡§¨‡•ç‡§ß 100% height ‡§¶‡•á‡§Ç */
        .main-container {
            height: 100%; 
            width: 100%;
            padding-top: 0 !important; 
            padding-bottom: 0 !important;
            margin: 0;
            overflow: hidden; /* ‡§Æ‡•Å‡§ñ‡•ç‡§Ø Scrollbar ‡§ï‡•ã ‡§∞‡•ã‡§ï‡•á‡§Ç */
        }
        
        /* FIX 3: Sidebar ‡§ï‡•ã Scrollable ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§¨‡§ü‡§® ‡§¶‡§ø‡§ñ‡•á‡§Ç */
        .sidebar {
            overflow-y: auto; 
            padding-bottom: 20px; 
        }
        
        /* ‡§Ö‡§®‡•ç‡§Ø ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§® */
        body {
            background-color: var(--ai-bg-color); 
        }
        .stats-card .card-title {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        /* Mobile adjustment */
        @media (max-width: 768px) {
            main {
                height: auto;
            }
            .main-container {
                height: auto; 
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div class="main-container">
        <div class="main-content">
            <div id="webcamContainer" class="webcam-panel">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="output_canvas"></canvas>
            </div>
            <div id="initialMessage" class="initial-message">
                <div class="logo">
                    <h1 class="logo-icon">üßò</h1>
                    <h2 class="logo-text">Yoga Sathi</h2>
                </div>
                <p>Allow camera access to enter the experience.</p>
            </div>
        </div>

        <aside class="sidebar">
            <div id="referencePoseContainer" class="info-card">
                <h4 id="poseName" class="pose-title">Trikonasana (Left Side)</h4>
                <div class="reference-image-wrapper">
                    <img
                        id="referenceImage"
                        src="{% static 'images/asanas/Trikonasana.png' %}"
                        alt="Reference Pose"
                    />
                </div>
                <div class="pose-timer-wrapper">
                    <i class="bi bi-hourglass-split"></i>
                    <span id="poseTimer" class="pose-timer-text">Hold Pose</span>
                </div>
            </div>

            <div class="info-card">
                <h5 class="card-title">
                    <i class="bi bi-cpu-fill"></i> AI Feedback Core
                </h5>
                <div id="feedbackBox" class="feedback-box" role="alert">
                    Click 'Start' to begin.
                </div>
                <div class="accuracy-wrapper mt-2">
                    <span>Pose Accuracy</span>
                    <div class="progress-bar-container">
                        <div id="accuracyBar" class="progress-bar"></div>
                    </div>
                </div>
            </div>

            <div class="info-card stats-card">
                <h5 class="card-title">
                    <i class="bi bi-bar-chart-fill"></i> Session Stats
                </h5>
                <div class="stat-item">
                    <i class="bi bi-clock-history"></i>
                    <span>Duration</span>
                    <strong id="duration">0s</strong>
                </div>
                <div class="stat-item">
                    <i class="bi bi-gem"></i>
                    <span>Quality</span>
                    <strong id="quality">--%</strong>
                </div>
            </div>

            <div class="controls mt-auto">
                <button id="startButton" class="btn btn-start">
                    <i class="bi bi-play-fill"></i> Start Session
                </button>
                <button id="stopButton" class="btn btn-stop" disabled>
                    <i class="bi bi-stop-fill"></i> Stop Session
                </button>
            </div>
        </aside>
    </div>
    <audio id="background-music" loop>
        <source
            src="{% static 'audio/background-music.mp3' %}"
            type="audio/mpeg"
        />
    </audio>
{% endblock content %}

{% block extra_js %}
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"
      crossorigin="anonymous"
    ></script>
    
    <script src="{% static 'js/trikonasana.js' %}"></script>
{% endblock %}